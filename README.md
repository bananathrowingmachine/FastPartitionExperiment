This is an astronomically fast partition algorithm. Partition is defined on page 405 of the pdf linked below.
A lot of credit goes to Jeff Erickson, author of https://jeffe.cs.illinois.edu/teaching/algorithms/book/Algorithms-JeffE.pdf, a free online textbook for my university algorithms class.

The overall idea of this algorithm is that it takes the best parts of a dynamic programming algorithm and a recursive algorithm, combines them together, then does a ton of insane math to speed things up even further.

I wrote this in python as it's fairly easy to understand what's going on in that language, especially to outsiders.

Why it works:
=
A bunch of crazy math in my head said so (BIG TODO, FINISH CODE FIRST)

Why it's so fast:
=
A bunch of crazier math in my head said so (BIGGER TODO, FINISH CODE FIRST)